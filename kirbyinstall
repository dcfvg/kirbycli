# kirby-install
# USAGE: kirbyinstall [-u user] [-e txtExt] precontent destination user

precontent=$1          # precontent folder
destination=$2         # destination folder
user=$3                # root username
dirext=ext             # extension directory

echo "$precontent as $destination"
echo "user : $user"
echo "-"

rm -rf $destination    # for dev only

git clone https://github.com/bastianallgeier/kirbycms.git $destination

cd $destination

rm *.mdown


# update .gitignore
sed -i ".bak" '/panel/d' .gitignore  # remove /panel from .gitignore
echo "/content" >> .gitignore
echo "/thumbs" >> .gitignore

# init panel

git submodule add https://github.com/bastianallgeier/kirbycms-panel.git panel
cp -r panel/defaults site/panel

# init main user
echo "set main user : $user"
sed "s/admin/$user/g" site/panel/accounts/admin.php > site/panel/accounts/$user.php
rm site/panel/accounts/admin.php

# init extension
git submodule add https://github.com/bastianallgeier/kirbycms-extensions.git $dirext

# install extentions
echo "copy fields, plugins and templates"
cp -r $dirext/fields/* panel/fields
cp -r $dirext/plugins/* site/plugins
cp -r $dirext/templates/* site/templates

# thumbs
echo "creating thumbs folder"
mkdir thumbs
chmod -R 747 thumbs

# content integration
echo "copy pre-content folder" 
cp -r ../$precontent/* content/

ls -la

git add -A && git commit -m "auto install with $precontent as $destination (user:$user)"
echo "ok !"